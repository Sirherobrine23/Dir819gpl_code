#! /usr/bin/make

include $(ROOTDIR)/.config

#T&W begin
EXT_TABLES-y :=
EXT_TABLES-${CONFIG_OPENSOURCE_EBT_PROUTE} += proute
EXT_TABLES-${CONFIG_OPENSOURCE_EBT_BROUTE} += broute
EXT_TABLES-${CONFIG_OPENSOURCE_EBT_FILTER} += filter
EXT_TABLES-${CONFIG_OPENSOURCE_EBT_NAT} += nat

EXT_FUNC-y += standard
EXT_FUNC-${CONFIG_OPENSOURCE_EBT_802_3} += 802_3
EXT_FUNC-${CONFIG_OPENSOURCE_EBT_AMONG} += among
EXT_FUNC-${CONFIG_OPENSOURCE_EBT_ARP} += arp
EXT_FUNC-${CONFIG_OPENSOURCE_EBT_IP} += ip
EXT_FUNC-${CONFIG_OPENSOURCE_EBT_LIMIT} += limit
EXT_FUNC-${CONFIG_OPENSOURCE_EBT_MARK_M} += mark_m
EXT_FUNC-${CONFIG_OPENSOURCE_EBT_PKTTYPE} += pkttype
EXT_FUNC-${CONFIG_OPENSOURCE_EBT_STP} += stp
EXT_FUNC-${CONFIG_OPENSOURCE_EBT_VLAN} += vlan
EXT_FUNC-${CONFIG_OPENSOURCE_EBT_TBSVLAN_M} += tbs_vlan_m
EXT_FUNC-${CONFIG_OPENSOURCE_EBT_TIME} += time
EXT_FUNC-${CONFIG_OPENSOURCE_EBT_ARPREPLY} += arpreply
EXT_FUNC-${CONFIG_OPENSOURCE_EBT_NAT} += nat
EXT_FUNC-${CONFIG_OPENSOURCE_EBT_MARK} += mark
EXT_FUNC-${CONFIG_OPENSOURCE_EBT_REDIRECT} += redirect
EXT_FUNC-${CONFIG_OPENSOURCE_EBT_FTOS} += ftos
EXT_FUNC-${CONFIG_OPENSOURCE_EBT_WMM_MARK} += wmm_mark
EXT_FUNC-${CONFIG_OPENSOURCE_EBT_VLAN_T} += vlan_t
EXT_FUNC-${CONFIG_OPENSOURCE_EBT_CLASSIFY} += classify
EXT_FUNC-${CONFIG_OPENSOURCE_EBT_LOG} += log

#T&W end

EXT_OBJS+=$(foreach T,$(EXT_FUNC-y), extensions/ebt_$(T).o)
EXT_OBJS+=$(foreach T,$(EXT_TABLES-y), extensions/ebtable_$(T).o)

extensions/ebt_%.o: extensions/ebt_%.c include/ebtables_u.h
	$(CC) $(CFLAGS) $(PROGSPECS) -c -o $@ $< -I$(KERNEL_INCLUDES)

extensions/ebtable_%.o: extensions/ebtable_%.c
	$(CC) $(CFLAGS) $(PROGSPECS) -c -o $@ $< -I$(KERNEL_INCLUDES)

